#!/bin/sh
#vim: syntax=sh

set -eu

if [ "$#" -eq 0 ]; then
  ls "$CONFIG_PATH/bin" | fzf | xargs -Ixxx nvim "$CONFIG_PATH/bin/xxx"
  exit 0
fi

if [ "$#" -gt 1 ]; then
  echo "too mach args"
  exit 1
fi

TARGET_FILE=$1

if [ -z "${CONFIG_PATH:-}" ]; then
  echo "need to set \$CONFIG_PATH"
  exit 1
fi

TARGET_PATH=$CONFIG_PATH/bin/$TARGET_FILE

if [ ! -f "$TARGET_PATH" ]; then
  {
    echo "#!/bin/sh"
    echo "#vim: syntax=sh"
    echo ""
    echo "set -eu"
  } >> "$TARGET_PATH"
  chmod 700 "$TARGET_PATH"
fi

nvim "$TARGET_PATH"
